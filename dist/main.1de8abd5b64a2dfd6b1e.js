"use strict";(self.webpackChunkscrum_project=self.webpackChunkscrum_project||[]).push([[179],{4477:(e,t,a)=>{a.d(t,{BR:()=>c,K5:()=>l,Kj:()=>o,Rm:()=>i,UN:()=>n,zA:()=>r});var s=a(8593);const n=e=>s.Z.get(`/api/project/${e}`),r=(e,t)=>s.Z.put(`/api/projects/${e}/kanban`,t),o=()=>s.Z.get("/api/users"),i=()=>s.Z.get("/api/organization"),c=()=>s.Z.get("/api/task/type_list"),l=e=>s.Z.get(`/api/project/${e}`)},2061:(e,t,a)=>{var s=a(7294),n=a(745),r=a(9250),o=a(5893);const i=function(e){return(0,o.jsxs)("div",{className:"login_wrap",children:[(0,o.jsx)("header",{className:"css-Jira"}),(0,o.jsx)("div",{className:"login_box_wrap",children:e.children})]})};var c=a(3923),l=a(5019),d=a(5187),p=a(5460),j=a(9655),u=a(8593);const _=function(){const e=(0,r.s0)(),[t]=c.Z.useForm();return(0,o.jsxs)(i,{children:[(0,o.jsxs)(c.Z,{form:t,children:[(0,o.jsx)("h2",{style:{marginBottom:"40px"},children:"请登录"}),(0,o.jsx)(c.Z.Item,{name:"username",rules:[{required:!0,message:"请输入用户名"}],children:(0,o.jsx)(l.Z,{placeholder:"用户名"})}),(0,o.jsx)(c.Z.Item,{name:"password",rules:[{required:!0,message:"请输入密码"}],children:(0,o.jsx)(l.Z.Password,{placeholder:"密码"})}),(0,o.jsx)(c.Z.Item,{children:(0,o.jsx)(d.ZP,{type:"primary",htmlType:"submit",className:"login_button",onClick:async function(){const a=await t.validateFields();a&&0===(await(({username:e,password:t})=>u.Z.post("/api/login",{username:e,password:t}))(a)).data.code&&e("/project")},children:"登录"})})]}),(0,o.jsx)(p.Z,{}),(0,o.jsx)(j.rU,{className:"login_enroll",to:"/register",children:"没有账号？注册新账号"})]})},m=function(){const[e]=c.Z.useForm();return(0,o.jsxs)(i,{children:[(0,o.jsxs)(c.Z,{form:e,children:[(0,o.jsx)("h2",{style:{marginBottom:"40px"},children:"请注册账号"}),(0,o.jsx)(c.Z.Item,{name:"username",rules:[{required:!0,message:"请输入用户名"}],children:(0,o.jsx)(l.Z,{placeholder:"用户名"})}),(0,o.jsx)(c.Z.Item,{name:"password",rules:[{required:!0,message:"请输入密码"}],children:(0,o.jsx)(l.Z.Password,{placeholder:"密码"})}),(0,o.jsx)(c.Z.Item,{children:(0,o.jsx)(d.ZP,{type:"primary",htmlType:"submit",className:"login_button",onClick:async function(){const t=await e.validateFields();t&&await(({username:e,password:t})=>u.Z.post("/api/register",{username:e,password:t}))(t)},children:"注册"})})]}),(0,o.jsx)(p.Z,{}),(0,o.jsx)(j.rU,{className:"login_enroll",to:"/login",children:"已有账号？直接登录"})]})};var h=a(2124),x=a(890),y=a(3754);const k=function(){let e=(0,o.jsxs)("div",{className:"project_create",children:[(0,o.jsx)(h.Z.Text,{type:"secondary",children:"收藏项目"}),(0,o.jsxs)(x.Z,{children:[(0,o.jsx)(x.Z.Item,{className:"project_listItem",children:(0,o.jsx)("p",{children:"项目1"})}),(0,o.jsx)(x.Z.Item,{className:"project_listItem",children:(0,o.jsx)("p",{children:"项目2"})}),(0,o.jsx)(x.Z.Item,{className:"project_listItem",children:(0,o.jsx)("p",{children:"项目3"})})]}),(0,o.jsx)(p.Z,{style:{margin:"0 0 14px 0"}}),(0,o.jsx)("div",{className:"project_create_name",children:"创建项目"})]});return(0,o.jsx)(y.Z,{placement:"bottom",content:e,children:(0,o.jsx)("h2",{className:"project_popover",children:"收藏项目"})})},Z=function(){let e=(0,o.jsxs)("div",{className:"project_create",children:[(0,o.jsx)(h.Z.Text,{type:"secondary",children:"成员列表"}),(0,o.jsxs)(x.Z,{children:[(0,o.jsx)(x.Z.Item,{className:"user_listItem",children:(0,o.jsx)("p",{children:"A"})}),(0,o.jsx)(x.Z.Item,{className:"user_listItem",children:(0,o.jsx)("p",{children:"B"})}),(0,o.jsx)(x.Z.Item,{className:"user_listItem",children:(0,o.jsx)("p",{children:"C"})})]})]});return(0,o.jsx)(y.Z,{placement:"bottom",content:e,children:(0,o.jsx)("h2",{className:"project_popover",children:"成员"})})},g=function(){const e=(0,r.s0)();return(0,o.jsxs)("div",{className:"header_wrap_body",children:[(0,o.jsxs)("button",{className:"header_button",onClick:function(){e("/project")},children:[(0,o.jsx)("div",{className:"icon_blue"}),(0,o.jsx)("h2",{children:"Jira Software"})]}),(0,o.jsx)(k,{}),(0,o.jsx)(Z,{}),(0,o.jsx)("div",{className:"header_login_out_btn",onClick:async function(){await u.Z.post("/api/logout"),e("/login")},children:"退出登录"})]})};var f=a(5761),b=a(5240),w=a(4589);function v(e,t,a){return{label:e,key:t,icon:a}}const I=[v("看板","kanban",(0,o.jsx)(b.Z,{style:{fontSize:"16px"}})),v("任务组","epic",(0,o.jsx)(w.Z,{style:{fontSize:"16px"}}))],N=function(){const e=(0,r.TH)(),[t,a]=(0,s.useState)(""),n=(0,r.UO)(),i=(0,r.s0)(),c=e.pathname.split("/");return(0,s.useEffect)((()=>{a(c[3])}),[c]),(0,o.jsx)(f.Z,{onClick:function(e){const t=e.key;a(t);const s=n.id;i(`/project/${s}/${t}`)},selectedKeys:t,mode:"inline",items:I})},C=function(){let e="/project"===(0,r.TH)().pathname;return(0,o.jsxs)("div",{className:"layout_wrap",children:[(0,o.jsx)("div",{className:"header_wrap",children:(0,o.jsx)(g,{})}),(0,o.jsxs)("div",{className:"layout_wrap_project",children:[e?null:(0,o.jsx)("div",{className:"project_side_menu_wrap",children:(0,o.jsx)(N,{})}),(0,o.jsx)("div",{className:"project_wrap",children:(0,o.jsx)(r.j3,{})})]})]})};var P=a(1127),z=a(2072),O=a(5554),F=a(7569),S=a(5007),T=a(3481),q=a(8130),E=a(7903),A=a(3798);const U=(0,q.oM)({name:"epic",initialState:{modal_show:!1},reducers:{set_epic_modal_show:(e,t)=>{e.modal_show=t.payload}}}),$=e=>e.epic.modal_show,{set_epic_modal_show:K}=U.actions,M=U.reducer,W=(0,q.xC)({reducer:{drop:E.ZP,project:T.ZP,kanban:A.ZP,epic:M}});var B=a(7484),R=a.n(B);const V=[{title:"",dataIndex:"collect",key:"collect",render:(e,t)=>(0,o.jsx)(F.Z,{onClick:()=>{!function(e){const t={...e,collect:!e.collect};(0,W.dispatch)((0,T.Mq)({_id:e._id,data:t})),u.Z.put(`/api/projects/${e._id}`,{collect:t.collect}),W.dispatch((0,T.ee)())}(t)},style:{color:e?"#f60":"#ccc"}}),width:"5%"},{title:"项目名称",dataIndex:"name",key:"name",render:(e,t)=>(0,o.jsx)(j.OL,{to:`/project/${t._id}/kanban`,children:e}),sorter:(e,t)=>e.title-t.title,width:"20%"},{title:"部门",dataIndex:"organization",key:"organization",width:"20%"},{title:"负责人",dataIndex:"owner",key:"owner",render:e=>(0,o.jsx)("div",{children:e}),width:"20%"},{title:"创建时间",key:"created",dataIndex:"created",render:(e,t)=>(0,o.jsx)(P.Z,{size:"middle",children:(0,o.jsx)("div",{children:R()(t.created).format("YYYY-MM-DD")})})},{title:"操作",key:"created",dataIndex:"created",render:(e,t)=>(0,o.jsxs)(P.Z,{children:[(0,o.jsx)(d.ZP,{type:"primary",onClick:()=>{var e;e=t._id,W.dispatch((0,T.O7)({show:!0,type:"edit",id:e}))},children:"编辑"}),(0,o.jsx)(d.ZP,{type:"primary",danger:!0,onClick:()=>{!async function(e){await u.Z.delete(`/api/projects/${e}`),W.dispatch((0,T.ee)())}(t._id)},children:"删除"})]})}],L=function(){console.log("ProjectTable render");const e=(0,S.I0)(),t=(0,S.v9)(T.pO),a=(0,S.v9)(T.q5,S.wU);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(z.Z,{rowKey:"created",loading:t,pagination:!1,className:"project_table_css",columns:V,dataSource:a.list}),(0,o.jsx)(O.Z,{onChange:function(t){e((0,T.Gy)(t)),e((0,T.ee)())},total:a.total,current:a.current_page})]})};var Y=a(1093),G=a(5826),D=a(3597);const H=function(){const e=(0,S.I0)(),{orgs_options:t,users_options:a}=(0,D.Z)(),n=(0,S.v9)(T.uw),r=(0,S.v9)(T.vt),[i]=c.Z.useForm(),d=n.show,p=n.type,j=n.id;return(0,s.useEffect)((()=>{if("edit"===p&&d){const e=r.find((e=>e._id===j)),t={name:e.name,organization:e.organization,owner:e.owner};i.setFieldsValue(t)}"create"===p&&d&&i.resetFields()}),[d]),(0,o.jsx)(Y.Z,{title:"edit"===p?"编辑项目":"创建项目",open:d,okText:"edit"===p?"编辑项目":"创建项目",onOk:async function(){const t=await i.validateFields();t&&("create"===p&&await u.Z.post("/api/projects",t),"edit"===p&&await u.Z.put(`/api/projects/${j}`,t),e((0,T.O7)({show:!1})),e((0,T.ee)()))},onCancel:()=>{e((0,T.O7)({show:!1}))},cancelText:"取消",children:(0,o.jsxs)(c.Z,{name:"basic",autoComplete:"off",form:i,children:[(0,o.jsx)(c.Z.Item,{label:"项目名称",name:"name",rules:[{required:!0,message:"请输入项目名称"}],children:(0,o.jsx)(l.Z,{})}),(0,o.jsx)(c.Z.Item,{label:"所在部门",name:"organization",rules:[{required:!0,message:"请选择部门"}],children:(0,o.jsx)(G.Z,{options:t})}),(0,o.jsx)(c.Z.Item,{label:"主负责人",name:"owner",rules:[{required:!0,message:"请选择主负责人"}],children:(0,o.jsx)(G.Z,{options:a})})]})})},J=function(){const e=(0,S.I0)(),{orgs_options:t,users_options:a}=(0,D.Z)(),[s]=c.Z.useForm();return(0,o.jsx)(c.Z,{layout:"inline",form:s,children:(0,o.jsxs)(P.Z,{direction:"horizontal",size:"large",children:[(0,o.jsx)(c.Z.Item,{name:"name",style:{width:200},children:(0,o.jsx)(l.Z,{placeholder:"任务名"})}),(0,o.jsx)(c.Z.Item,{label:"部门",name:"organization",style:{width:200},children:(0,o.jsx)(G.Z,{options:t})}),(0,o.jsx)(c.Z.Item,{label:"主负责人",name:"owner",style:{width:200},children:(0,o.jsx)(G.Z,{options:a})}),(0,o.jsx)(d.ZP,{onClick:function(){s.resetFields()},type:"default",children:"重置"}),(0,o.jsx)(d.ZP,{onClick:async function(){const t=await s.validateFields();t&&(e((0,T.P_)(t)),e((0,T.Gy)(1)),e((0,T.ee)()))},type:"primary",children:"查询"})]})})},Q=function(){console.log("project render");const e=(0,S.I0)();return(0,o.jsxs)(P.Z,{direction:"vertical",size:"large",style:{display:"flex"},children:[(0,o.jsxs)("div",{className:"project_title_wrap",children:[(0,o.jsx)("h1",{children:"项目列表"}),(0,o.jsx)("button",{onClick:function(){e((0,T.O7)({show:!0,type:"create"}))},children:"创建项目"})]}),(0,o.jsx)("div",{className:"project_search_wrap",children:(0,o.jsx)(J,{})}),(0,o.jsx)("div",{className:"project_table_wrap",children:(0,o.jsx)(L,{})}),(0,o.jsx)(H,{})]})};function X(){return(0,S.I0)(),(0,r.UO)().id,(0,o.jsx)(P.Z,{children:(0,o.jsx)(d.ZP,{onClick:()=>{Y.Z.confirm({okText:"确定",cancelText:"取消",title:"确定删除该项目组吗？",async onOk(){}})},children:"删除"})})}const ee=function(){const e=(0,S.v9)(A.iI),t=(0,r.s0)(),a=(0,r.UO)();return(0,o.jsx)(x.Z,{itemLayout:"horizontal",dataSource:e,renderItem:e=>(0,o.jsx)(x.Z.Item,{style:{height:"135px"},children:(0,o.jsx)(x.Z.Item.Meta,{title:(0,o.jsxs)("div",{className:"list_item_title",children:[(0,o.jsx)("div",{onClick:()=>{!function(e){t({pathname:`/project/${a.id}/kanban`,search:(0,j.fW)({epic:e}).toString()})}(e)},style:{fontSize:"18px",color:"black"},children:e}),(0,o.jsx)(X,{})]}),description:(0,o.jsxs)("div",{style:{fontSize:"16px"},children:[(0,o.jsx)("div",{children:"开始时间：暂无"}),(0,o.jsx)("div",{children:"结束时间: 暂无"})]})})})})},te=function(){const e=(0,S.v9)($),t=(0,S.I0)(),[a]=c.Z.useForm(),s=(0,r.UO)().id;return(0,o.jsxs)(Y.Z,{title:"创建 EPIC",open:e,okText:"创建 EPIC",onOk:async function(){const e=await a.validateFields(),n=e.epic_name;e&&(await u.Z.post(`/api/epic/${s}`,{epic_name:n}),t(K(!1)),t((0,T.iE)(s)))},onCancel:function(){t(K(!1))},cancelText:"取消",children:[(0,o.jsx)(p.Z,{}),(0,o.jsx)(c.Z,{name:"basic",autoComplete:"off",form:a,children:(0,o.jsx)(c.Z.Item,{label:"Epic 名称",name:"epic_name",rules:[{required:!0,message:"请输入Epic名称"}],children:(0,o.jsx)(l.Z,{})})}),(0,o.jsx)(p.Z,{})]})},ae=function(){const e=(0,S.I0)(),t=(0,r.UO)(),a=t.id;return(0,s.useEffect)((()=>{e((0,T.iE)(a)),e((0,E.Wv)(a))}),[t.id]),(0,o.jsxs)("div",{className:"epic_body",children:[(0,o.jsx)("div",{className:"epic_title",children:(0,o.jsx)("button",{className:"epic_title_button",onClick:function(){e(K(!0))},children:"创建任务组"})}),(0,o.jsx)(ee,{}),(0,o.jsx)(te,{})]})};var se=a(8135),ne=a(4996);const re=(0,s.lazy)((()=>Promise.all([a.e(736),a.e(936)]).then(a.bind(a,9894))));function oe(){return(0,o.jsx)(s.Suspense,{fallback:(0,o.jsx)("div",{children:"Loading..."}),children:(0,o.jsx)(re,{})})}const ie=function(){console.log("app render");const e=(0,r.TH)(),t=(0,r.s0)(),a=(0,S.I0)(),[n,i]=se.Z.useNotification(),c=(e,t)=>{n[t]({message:e,placement:"topRight"})};return(0,s.useEffect)((()=>{"/"===e.pathname&&t("/project"),a((0,T.AK)()),a((0,T.eb)()),a((0,T.t1)()),a((0,T.ee)()),ne.Z.on("global_not_login",(function(e){t("/login")})),ne.Z.on("global_error_tips",(e=>{c(e,"error")})),ne.Z.on("global_success_tips",(e=>{c(e,"success")}))}),[]),(0,o.jsxs)("div",{className:"App",children:[i,(0,o.jsxs)(r.Z5,{children:[(0,o.jsx)(r.AW,{path:"/login",element:(0,o.jsx)(_,{})}),(0,o.jsx)(r.AW,{path:"/register",element:(0,o.jsx)(m,{})}),(0,o.jsxs)(r.AW,{element:(0,o.jsx)(C,{}),children:[(0,o.jsx)(r.AW,{path:"/project",element:(0,o.jsx)(Q,{})}),(0,o.jsx)(r.AW,{path:"/project/:id/kanban",element:(0,o.jsx)(oe,{})}),(0,o.jsx)(r.AW,{path:"/project/:id/epic",element:(0,o.jsx)(ae,{})})]})]})]})};var ce;n.createRoot(document.getElementById("root")).render((0,o.jsx)(S.zt,{store:W,children:(0,o.jsx)(j.VK,{children:(0,o.jsx)(ie,{})})})),ce&&ce instanceof Function&&a.e(736).then(a.bind(a,2131)).then((({getCLS:e,getFID:t,getFCP:a,getLCP:s,getTTFB:n})=>{e(ce),t(ce),a(ce),s(ce),n(ce)}))},3597:(e,t,a)=>{a.d(t,{Z:()=>r});var s=a(5007),n=a(3481);const r=function(){const e=(0,s.v9)(n.TV),t=(0,s.v9)(n.VP);return{orgs_options:e.map((e=>({value:e.name,label:e.name}))),users_options:t.map((e=>({value:e.username,label:e.username}))),task_options:[{value:"task",label:"task"},{value:"bug",label:"bug"}]}}},7903:(e,t,a)=>{a.d(t,{Sr:()=>r,Wv:()=>l,Wx:()=>_,ZP:()=>x,cY:()=>p,gZ:()=>h,h7:()=>u,rK:()=>d,sc:()=>c,tM:()=>m,yk:()=>j});var s=a(8130),n=a(4477);const r=(0,s.hg)("drop/update",(async(e,t)=>{const a=t.getState(),s=a.drop.kanban_data,r=a.drop.project_id;await(0,n.zA)(r,s)}));function o(e,t,a){const s=e,[n]=s.splice(t,1);return s.splice(a,0,n),s}const i=(0,s.oM)({name:"drop",initialState:{kanban_data:[],project_id:""},reducers:{set_kanban_data:(e,t)=>{e.kanban_data=t.payload},set_project_id:(e,t)=>{e.project_id=t.payload},kanban_order:(e,t)=>{o(e.kanban_data,t.payload.source,t.payload.destination)},task_same_order:(e,t)=>{o(e.kanban_data.find((e=>e.kanban_key===t.payload.kanban_key)).task,t.payload.source,t.payload.destination)},task_diff_order:(e,t)=>{const a=e.kanban_data.find((e=>e.kanban_key===t.payload.source_key)),s=e.kanban_data.find((e=>e.kanban_key===t.payload.destination_key)),n=a.task,r=s.task;let o=n[t.payload.source];n.splice(t.payload.source,1),r.splice(t.payload.destination,0,o)},add_kanban:(e,t)=>{const a=t.payload.kanban_key;e.kanban_data.push({kanban_key:a,task:[]})},add_task:(e,t)=>{const a=t.payload.kanban_key,s=t.payload.task;e.kanban_data.find((e=>e.kanban_key===a)).task.push(s)},update_task:(e,t)=>{const a=t.payload.kanban_key;let s=t.payload.task;const n=t.payload.task_id,r=e.kanban_data.find((e=>e.kanban_key===a)),o=r.task.findIndex((e=>e.task_id===n));s.task_id=r.task.task_id,r.task[o]=s}}}),c=e=>e.drop.kanban_data,{set_project_id:l,set_kanban_data:d,kanban_order:p,task_same_order:j,task_diff_order:u,add_kanban:_,add_task:m,update_task:h}=i.actions,x=i.reducer},3798:(e,t,a)=>{a.d(t,{Iv:()=>n,UZ:()=>i,ZP:()=>l,iI:()=>o,kG:()=>r,mx:()=>c});const s=(0,a(8130).oM)({name:"kanban",initialState:{task_modal_status:{show:!1,kanban_key:"",task_id:"",type:"create"},current_project:{}},reducers:{set_current_project:(e,t)=>{e.current_project=t.payload},set_task_modal:(e,t)=>{Object.keys(t.payload).forEach((a=>{e.task_modal_status[a]=t.payload[a]}))}}}),n=e=>e.kanban.task_modal_status,r=e=>e.kanban.current_project,o=e=>e.kanban.current_project.epic,{set_current_project:i,set_task_modal:c}=s.actions,l=s.reducer},3481:(e,t,a)=>{a.d(t,{AK:()=>d,Gy:()=>g,Mq:()=>Z,O7:()=>f,P_:()=>b,TV:()=>x,VP:()=>h,ZP:()=>w,eb:()=>p,ee:()=>c,iE:()=>l,pO:()=>_,q5:()=>y,t1:()=>j,uw:()=>k,vt:()=>m});var s=a(8130),n=a(4477),r=a(7903),o=a(3798),i=a(8593);const c=(0,s.hg)("project/get_project_list",(async(e,t)=>{const a=t.getState(),s=10*(a.project.current_page-1),n=a.project.search_query;return(await i.Z.post("/api/projects/search",{...n,skip:s})).data})),l=(0,s.hg)("project/get_project",(async(e,t)=>{const a=await(0,n.UN)(e),s=a.data.data.kanban;return t.dispatch((0,r.rK)(s)),t.dispatch((0,o.UZ)(a.data.data)),s})),d=(0,s.hg)("project/get_users",(async()=>(await(0,n.Kj)()).data)),p=(0,s.hg)("project/get_org",(async()=>(await(0,n.Rm)()).data)),j=(0,s.hg)("project/get_task_type",(async()=>(await(0,n.BR)()).data)),u=(0,s.oM)({name:"project",initialState:{list:[],loading:!1,users:[],organizations:[],task_types:[],total:0,current_page:1,project_modal:{show:!1,type:"create",id:""},search_query:{}},reducers:{change_list:(e,t)=>{const{_id:a,data:s}=t.payload,n=e.list.findIndex((e=>e.id===a));e.list[n]=s},set_current_page:(e,t)=>{e.current_page=t.payload},set_project_modal:(e,t)=>{e.project_modal={...e.project_modal,...t.payload}},set_search_query:(e,t)=>{e.search_query=t.payload}},extraReducers:e=>{e.addCase(c.pending,((e,t)=>{e.loading=!0})),e.addCase(c.fulfilled,((e,t)=>{const a=t.payload.data.data,s=t.payload.data.total;a.forEach((e=>{void 0===e.collect&&(e.collect=!1)})),e.list=a,e.loading=!1,e.total=s})),e.addCase(d.fulfilled,((e,t)=>{e.users=t.payload.data})),e.addCase(p.fulfilled,((e,t)=>{e.organizations=t.payload.data})),e.addCase(j.fulfilled,((e,t)=>{e.task_types=t.payload.data}))}}),_=e=>e.project.loading,m=e=>e.project.list,h=e=>e.project.users,x=e=>e.project.organizations,y=e=>({list:e.project.list,current_page:e.project.current_page,total:e.project.total}),k=e=>e.project.project_modal,{change_list:Z,set_current_page:g,set_project_modal:f,set_search_query:b}=u.actions,w=u.reducer},4996:(e,t,a)=>{a.d(t,{Z:()=>s});const s=new(a(7187).EventEmitter)},8593:(e,t,a)=>{a.d(t,{Z:()=>o});var s=a(1257),n=a(4996);const r=s.Z.create({timeout:5e4});r.interceptors.response.use((e=>{if(200===e.status){if(401===e.data.code)return n.Z.emit("global_not_login",e.data.msg),Promise.reject("没有登录状态");0!==e.data.code&&401!==e.data.code&&n.Z.emit("global_error_tips",e.data.msg)}else n.Z.emit("global_error_tips",e.data.msg);return e}),(e=>Promise.reject(e)));const o=r}},e=>{e.O(0,[736],(()=>(2061,e(e.s=2061)))),e.O()}]);
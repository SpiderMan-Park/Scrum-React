"use strict";(self.webpackChunkscrum_project=self.webpackChunkscrum_project||[]).push([[936],{9894:(e,a,n)=>{n.r(a),n.d(a,{default:()=>C});var s=n(7294),t=n(3923),r=n(1127),i=n(5019),d=n(5826),l=n(5187),c=n(5007),o=n(9655),p=n(9250),k=n(4477),x=n(7903),m=n(3798),u=n(3597),_=n(5893);const h=function(){const e=(0,c.I0)(),{task_options:a,users_options:n}=(0,u.Z)(),[h]=(0,o.lr)(),[b]=t.Z.useForm(),j=h.get("epic"),y=(0,c.v9)(m.iI)||[],f=(0,p.UO)().id;(0,s.useEffect)((()=>{j&&b.setFieldValue("epic",j)}),[]);const Z=y.map((e=>({value:e,label:e})));return(0,_.jsx)(t.Z,{form:b,children:(0,_.jsxs)(r.Z,{direction:"horizontal",size:"large",children:[(0,_.jsx)(t.Z.Item,{name:"name",children:(0,_.jsx)(i.Z,{placeholder:"任务名"})}),(0,_.jsx)(t.Z.Item,{label:"主负责人：",name:"owner",children:(0,_.jsx)(d.Z,{style:{width:140},options:n})}),(0,_.jsx)(t.Z.Item,{label:"任务类型：",name:"type",children:(0,_.jsx)(d.Z,{style:{width:140},options:a})}),(0,_.jsx)(t.Z.Item,{label:"epic：",name:"epic",children:(0,_.jsx)(d.Z,{style:{width:140},options:Z})}),(0,_.jsx)(t.Z.Item,{children:(0,_.jsx)(l.ZP,{onClick:function(){b.resetFields()},children:"重置"})}),(0,_.jsx)(t.Z.Item,{children:(0,_.jsx)(l.ZP,{type:"primary",onClick:async function(){const a=await b.validateFields();a&&await async function(a){let n=(await(0,k.K5)(f)).data.data.kanban.map((e=>{let n=e.task;return n=n.filter((e=>{let n=!0,s=!0,t=!0,r=!0;return a.name&&e.name.indexOf(a.name)<0&&(n=!1),a.owner&&e.owner!==a.owner&&(t=!1),a.type&&e.type!==a.type&&(s=!1),a.epic&&e.epic!==a.epic&&(r=!1),n&&s&&t&&r})),{...e,task:n}}));e((0,x.rK)(n))}(a)},children:"查询"})})]})})};var b=n(2345),j=n(3967),y=n.n(j);const f=function(e){const a=(0,c.I0)(),n=e.task,s=n.task;return(0,_.jsx)(b.bK,{droppableId:n.kanban_key,type:"task",children:(e,t)=>(0,_.jsxs)("div",{className:"task_drop_wrap",ref:e.innerRef,...e.draggableProps,children:[s.map(((e,s)=>(0,_.jsx)(b._l,{draggableId:`${n.kanban_key}_${e.name}`,index:s,children:(s,t)=>(0,_.jsx)("div",{className:"task_drag_wrap",ref:s.innerRef,...s.draggableProps,...s.dragHandleProps,onClick:()=>{var s,t;s=n.kanban_key,t=e.task_id,a((0,m.mx)({kanban_key:s,task_id:t,show:!0,type:"edit"}))},children:(0,_.jsxs)("div",{className:"task_card",children:[(0,_.jsxs)("div",{className:"task_card_top",children:[(0,_.jsx)("div",{className:"task_head_picture",alt:""}),(0,_.jsx)("div",{className:"task_head-p",children:e.name})]}),(0,_.jsxs)("div",{className:"task_card_bottom",children:[(0,_.jsx)("div",{className:"task_owner",children:e.owner}),(0,_.jsx)("div",{className:y()({new_task_type:!0,red:"bug"===e.type,blue:"task"===e.type}),children:(0,_.jsx)("span",{className:"task_type-span",children:e.type})})]})]})})},`${n.kanban_key}_${e.name}`))),e.placeholder]})})};function Z(e){const a=(0,c.I0)();console.log("DropCp render");const n=e.drop_test_data.count,s=(0,c.v9)(x.sc);return(0,_.jsxs)(b.Z5,{onDragEnd:function(e){e.destination&&("kanban"===e.type&&(a((0,x.cY)({source:e.source.index,destination:e.destination.index})),a((0,x.Sr)())),"task"===e.type&&(e.source.droppableId===e.destination.droppableId?(a((0,x.yk)({kanban_key:e.destination.droppableId,source:e.source.index,destination:e.destination.index})),a((0,x.Sr)())):(a((0,x.h7)({source_key:e.source.droppableId,destination_key:e.destination.droppableId,source:e.source.index,destination:e.destination.index})),a((0,x.Sr)()))))},children:[(0,_.jsx)(b.bK,{direction:"horizontal",droppableId:"droppable-xxx",type:"kanban",children:(e,t)=>(0,_.jsxs)("div",{className:"kanban_drop_wrap",ref:e.innerRef,...e.draggableProps,children:[s.map(((e,s)=>(0,_.jsx)(b._l,{draggableId:e.kanban_key,index:s,children:(s,t)=>(0,_.jsxs)("div",{className:"kanban_drag_wrap",ref:s.innerRef,...s.draggableProps,...s.dragHandleProps,children:[(0,_.jsx)("h1",{className:"kanban_drag_title",children:e.kanban_key}),"count:",n,(0,_.jsx)(f,{task:e}),(0,_.jsx)(l.ZP,{className:"new_task_btn",type:"primary",onClick:()=>{var n;n=e.kanban_key,a((0,m.mx)({show:!0,kanban_key:n,type:"create"}))},children:"新建task"})]})},e.kanban_key))),e.placeholder]})}),(0,_.jsx)("div",{className:"kanban_drag_wrap",children:(0,_.jsx)(i.Z,{style:{width:"280px"},placeholder:"新建看板名称",onPressEnter:function(e){const n=e.target.value.trim();n&&(a((0,x.Wx)({kanban_key:n})),a((0,x.Sr)()))}})})]})}const g=s.memo(Z);var v=n(3481),w=n(1093),I=n(5460);const N=function(){const{show:e,type:a,kanban_key:n,task_id:r}=(0,c.v9)(m.Iv),l=(0,c.I0)(),{task_options:o,users_options:p}=(0,u.Z)(),[k]=t.Z.useForm(),h=(0,c.v9)(x.sc),b=(0,c.v9)(m.iI)||[];(0,s.useEffect)((()=>{if("edit"===a&&e){const e=h.find((e=>e.kanban_key===n)).task.find((e=>e.task_id===r));k.setFieldsValue(e)}"create"===a&&e&&k.resetFields()}),[e]);const j=b.map((e=>({value:e,label:e})));return(0,_.jsxs)(w.Z,{open:e,title:"create"===a?"创建任务":"修改任务",onOk:async function(){const e=await k.validateFields();e&&("create"===a&&(e.task_id=Math.random().toString(32).substring(2),l((0,x.tM)({kanban_key:n,task:e})),l((0,x.Sr)())),"edit"===a&&(l((0,x.gZ)({task:e,task_id:r,kanban_key:n})),l((0,x.Sr)())),l((0,m.mx)({show:!1})))},onCancel:()=>{l((0,m.mx)({show:!1}))},okText:"create"===a?"创建":"修改",cancelText:"取消",children:[(0,_.jsx)(I.Z,{}),(0,_.jsxs)(t.Z,{form:k,children:[(0,_.jsx)(t.Z.Item,{label:"任务名称",name:"name",rules:[{required:!0,message:"请输入任务名称"}],children:(0,_.jsx)(i.Z,{})}),(0,_.jsx)(t.Z.Item,{label:"任务类型",name:"type",rules:[{required:!0,message:"请选择任务类型"}],children:(0,_.jsx)(d.Z,{options:o})}),(0,_.jsx)(t.Z.Item,{label:"主负责人",name:"owner",rules:[{required:!0,message:"请选择主负责人"}],children:(0,_.jsx)(d.Z,{options:p})}),(0,_.jsx)(t.Z.Item,{label:"epic",name:"epic",rules:[{message:"请选择epic"}],children:(0,_.jsx)(d.Z,{options:j})})]}),(0,_.jsx)(I.Z,{})]})},C=function(){console.log("kanban render");const e=(0,c.I0)(),a=(0,p.UO)(),n=a.id,t=(0,c.v9)(m.kG),[i]=(0,o.lr)(),d=i.get("epic"),[l,k]=(0,s.useState)(1);(0,s.useEffect)((()=>{e((0,v.iE)(n)).then((a=>{const n=a.payload;if(d){const a={epic:d};let s=n.map((e=>{let n=e.task;return n=n.filter((e=>{let n=!0,s=!0,t=!0,r=!0;return a.name&&e.name.indexOf(a.name)<0&&(n=!1),a.owner&&e.owner!==a.owner&&(t=!1),a.type&&e.type!==a.type&&(s=!1),a.epic&&e.epic!==a.epic&&(r=!1),n&&s&&t&&r})),{...e,task:n}}));e((0,x.rK)(s))}})),e((0,x.Wv)(n))}),[a.id]);const u=(0,s.useCallback)((function(){}),[]),b=(0,s.useMemo)((()=>({count:0})),[]);return(0,_.jsxs)(r.Z,{direction:"vertical",size:"large",style:{display:"flex"},children:[(0,_.jsxs)("div",{children:[(0,_.jsxs)("h1",{className:"kanban_title",children:[t.name,"-研发看板"]}),l,(0,_.jsx)("button",{onClick:function(){k(l+1)},children:"+1"})]}),(0,_.jsx)(h,{}),(0,_.jsx)("div",{className:"drop_wrap",children:(0,_.jsx)(g,{drop_test_data:b,some_event:u})}),(0,_.jsx)(N,{})]})}}}]);